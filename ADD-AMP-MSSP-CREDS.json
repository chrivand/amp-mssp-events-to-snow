{
  "workflow": {
    "unique_name": "definition_workflow_01L0MYMOQ6CE003HOlWKmVjaSisNMB7WwXN",
    "name": "ADD-AMP-MSSP-CREDS",
    "title": "ADD-AMP-MSSP-CREDS",
    "type": "generic.workflow",
    "base_type": "workflow",
    "variables": [
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "input",
          "name": "Customer Name",
          "type": "datatype.string",
          "is_required": true,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01L0N95PFT4P34267yTBHZ07GAlBJvTKlR6",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "input",
          "name": "AMP API Client ID",
          "type": "datatype.string",
          "is_required": true,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01L0NA4BV41425bxLx2u9cnZzJWTzBT6zZQ",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "input",
          "name": "AMP API Client Secret",
          "type": "datatype.string",
          "is_required": true,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01L0NAADHNXX37bo736QhdIUuFYsIFHBz1R",
        "object_type": "variable_workflow"
      }
    ],
    "properties": {
      "atomic": {
        "is_atomic": false
      },
      "delete_workflow_instance": false,
      "description": "RUN EVERY TIME NEW CUSTOMER IS ADDED\n\nMake sure global table is set first as described in install insctructions! This workflow takes in the customer name, API client ID and API client secret and stores them in a table. This table can be used by other workflows to loop through API credentials of various MSSP customers. Please note that the credentials are base 64 encoded, however are stored in the global table variable.  SecureX is secured with MFA, but this still needs to be taken into consideration. ",
      "display_name": "ADD-AMP-MSSP-CREDS",
      "runtime_user": {
        "override_target_runtime_user": false,
        "specify_on_workflow_start": false,
        "target_default": true
      },
      "target": {
        "execute_on_target_group": false,
        "execute_on_workflow_target": false,
        "no_target": true,
        "specify_on_workflow_start": false
      }
    },
    "object_type": "definition_workflow",
    "actions": [
      {
        "unique_name": "definition_activity_01L0N0BVYCOH26m9vKzuNTDFeKyfwaY7jQ7",
        "name": "Execute Python Script",
        "title": "Encode API Credentials",
        "type": "python3.script",
        "base_type": "activity",
        "properties": {
          "action_timeout": 180,
          "continue_on_failure": false,
          "display_name": "Encode API Credentials",
          "script": "import sys, base64\n\napi_client_id = sys.argv[1]\napi_client_secret = sys.argv[2]\n\nconcat_string = api_client_id + \":\" + api_client_secret\nstring_bytes = concat_string.encode(\"ascii\") \n  \nbase64_bytes = base64.b64encode(string_bytes) \nbase64_string = base64_bytes.decode(\"ascii\")\n\n",
          "script_arguments": [
            "$workflow.definition_workflow_01L0MYMOQ6CE003HOlWKmVjaSisNMB7WwXN.input.variable_workflow_01L0NA4BV41425bxLx2u9cnZzJWTzBT6zZQ$",
            "$workflow.definition_workflow_01L0MYMOQ6CE003HOlWKmVjaSisNMB7WwXN.input.variable_workflow_01L0NAADHNXX37bo736QhdIUuFYsIFHBz1R$"
          ],
          "script_queries": [
            {
              "script_query": "base64_string",
              "script_query_name": "base64_string",
              "script_query_type": "string"
            }
          ],
          "skip_execution": false
        },
        "object_type": "definition_activity"
      },
      {
        "unique_name": "definition_activity_01L0N8XUBUACP2bNfMiaaYOMOjw2g6ORJAA",
        "name": "Add Row to Table",
        "title": "Add API keys to global table",
        "type": "core.addrowtotable",
        "base_type": "activity",
        "properties": {
          "action_timeout": 180,
          "continue_on_failure": false,
          "display_name": "Add API keys to global table",
          "input_table": "$global.variable_01L0MYHNLJWFB3Ny4PX1CukWfLoXMtcL7MA.global.variable_01L0MYHNLJWFB3Ny4PX1CukWfLoXMtcL7MA$",
          "row": [
            {
              "key": "customer_name",
              "type": "string",
              "value": "$workflow.definition_workflow_01L0MYMOQ6CE003HOlWKmVjaSisNMB7WwXN.input.variable_workflow_01L0N95PFT4P34267yTBHZ07GAlBJvTKlR6$"
            },
            {
              "key": "encoded_api_credentials",
              "type": "string",
              "value": "$activity.definition_activity_01L0N0BVYCOH26m9vKzuNTDFeKyfwaY7jQ7.output.script_queries.base64_string$"
            }
          ],
          "skip_execution": false
        },
        "object_type": "definition_activity"
      }
    ],
    "categories": [
      "category_01LFVC3JCKKBQ1UfvFwNNrvmyENRe5QPcKP"
    ]
  },
  "categories": {
    "category_01LFVC3JCKKBQ1UfvFwNNrvmyENRe5QPcKP": {
      "unique_name": "category_01LFVC3JCKKBQ1UfvFwNNrvmyENRe5QPcKP",
      "name": "AMP-SNOW-PROJECT",
      "title": "AMP-SNOW-PROJECT",
      "type": "basic.category",
      "base_type": "category",
      "description": "CHRIVAND",
      "category_type": "custom",
      "object_type": "category"
    }
  },
  "variables": {
    "variable_01L0MYHNLJWFB3Ny4PX1CukWfLoXMtcL7MA": {
      "unique_name": "variable_01L0MYHNLJWFB3Ny4PX1CukWfLoXMtcL7MA",
      "schema_id": "tabletype_01L0MWTPNG9LB0wNdXvayKxmQXu8O0CK94X",
      "properties": {
        "value": [
          {
            "column_data": {
              "customer_name": "Company A",
              "encoded_api_credentials": "OTFlZTQ4NTM3ZmY5N2Q1NjQ1M2E6ZmI3NTI4N2UtZjNhZS00NWM5LTgxMjktZGM5OTFhOWJlODEz"
            }
          },
          {
            "column_data": {
              "customer_name": "Company B",
              "encoded_api_credentials": "OTFlZTQ4NTM3ZmY5N2Q1NjQ1M2E6ZmI3NTI4N2UtZjNhZS00NWM5LTgxMjktZGM5OTFhOWJlODEz"
            }
          },
          {
            "column_data": {
              "customer_name": "Company X",
              "encoded_api_credentials": "YmU2NmZmMTI3ZWY1NDY4OWZhMTM6MDcxZjQ5N2UtMWEzYS00NGI0LTlkNWQtNTQyZDkyMDBkZmMw"
            }
          }
        ],
        "scope": "global",
        "name": "AMP_MSSP_credentials_table",
        "type": "datatype.table",
        "is_required": false,
        "is_invisible": false
      },
      "object_type": "variable"
    }
  },
  "table_types": {
    "tabletype_01L0MWTPNG9LB0wNdXvayKxmQXu8O0CK94X": {
      "unique_name": "tabletype_01L0MWTPNG9LB0wNdXvayKxmQXu8O0CK94X",
      "data_type": "datatype.tabletype",
      "display_name": "AMP_MSSP_credentials",
      "description": "chrivand for mssp project",
      "columns": [
        {
          "is_required": true,
          "name": "customer_name",
          "title": "Customer Name",
          "type": "string"
        },
        {
          "is_required": true,
          "name": "encoded_api_credentials",
          "title": "Encoded API Credentials",
          "type": "string"
        }
      ],
      "base_type": "datatype",
      "object_type": "tabletype"
    }
  }
}
